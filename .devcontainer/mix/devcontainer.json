{
	"name": "Unix tools, (bio)conda (miniforge) and R(Studio)",
	// https://rocker-project.org/images/devcontainer/images.html
	"image": "ghcr.io/rocker-org/devcontainer/tidyverse:4",
	// Base image could be modified to allow non-root user to start rstudio server
	// See https://github.com/rocker-org/rocker-versioned2/issues/592
	// "build": {
	// 	"context": "../..",
	// 	"dockerfile": "Dockerfile"
	// },
	// "remoteUser": "rstudio",
    // but this seems to fail.
	// Fortunately, the rocker environments seem to launch
	// a regular user bash session: https://github.com/rocker-org/rocker/wiki/managing-users-in-docker
	"features": {
		// https://github.com/rocker-org/devcontainer-features/blob/main/src/rstudio-server/README.md
		// RStudio is already pre-installed in tidyverse container - https://rocker-project.org/images/devcontainer/images.html#rstudio-server
		"ghcr.io/rocker-org/devcontainer-features/rstudio-server:latest": {},
		// https://github.com/rocker-org/devcontainer-features/tree/main/src/apt-packages
		"ghcr.io/rocker-org/devcontainer-features/apt-packages:1": {
			"packages": "libglpk-dev,nano,vim,less,git,screen,tmux,wget,curl,colordiff,htop,tree,graphviz" // "libglpk-dev" is required for igraph
		},
		// https://github.com/rocker-org/devcontainer-features/blob/main/src/r-packages/README.md
		"ghcr.io/rocker-org/devcontainer-features/r-packages:1": {
			"packages": "devtools,languageserver,tidyverse,rmarkdown,markdown,shiny,shinythemes,BiocManager,github::bahlolab/isoRelate,sjmisc,networkD3,igraph,RColorBrewer,viridis,vcfR,poppr,ggfortify",
			"installSystemRequirements": true
		},
		// https://github.com/rocker-org/devcontainer-features/blob/main/src/miniforge/README.md
		"ghcr.io/rocker-org/devcontainer-features/miniforge:2": {
			"version": "latest",
			"variant": "Miniforge3"
		}
		// https://github.com/mamba-org/devcontainer-features/tree/main/src/micromamba
		// "ghcr.io/mamba-org/devcontainer-features/micromamba:1": {}
	},
	// Use 'postCreateCommand' to run commands after the container is created.
	// "postStartCommand": "if [ -f environment.yml ]; then umask 0002 && /opt/conda/bin/mamba env update -n base -f environment.yml; fi",
	// "postCreateCommand": "/opt/conda/bin/mamba env update -y -n base -f environment.yml",
	// Disabled because the postCreateCommand seems to interfer with the internal commands run
	// by the rocker image which set the R package repositories, and it becomes impossible
	// to use install.packages() afterwards, even when specifying a repository url.
	"postAttachCommand": {
		"rstudio-start": "rserver"
	},
	"forwardPorts": [
		8787
	],
	"portsAttributes": {
		"8787": {
			"label": "RStudio IDE"
		}
	},
	"customizations": {
		"vscode": {
			"settings": {
				"workbench.editor.highlightModifiedTabs": true,
				"workbench.tree.renderIndentGuides": "always",
				"indentRainbow.lightIndicatorStyleLineWidth": 5,
				"indentRainbow.indicatorStyle": "light",
				"workbench.editor.wrapTabs": true,
				"explorer.compactFolders": false,
				"files.eol": "\n",
				"editor.wordWrap": "on",
				"editor.renderWhitespace": "trailing",
				"editor.bracketPairColorization.enabled": true,
				// "terminal.integrated.scrollback": 10000,
				"files.trimFinalNewlines": true,
				"files.trimTrailingWhitespace": true,
				"editor.formatOnType": true,
				"editor.formatOnSave": true,
			},
			"extensions": [
				// bash extensions
				"foxundermoon.shell-format",
				"mads-hartmann.bash-ide-vscode",
				"timonwong.shellcheck",

				// QoL
				"streetsidesoftware.code-spell-checker",
				"oderwat.indent-rainbow",
				"mechatroner.rainbow-csv",
				"ionutvmi.path-autocomplete",

				// R
				"REditorSupport.r",
				"REditorSupport.r-syntax",

				// general formatting
				"esbenp.prettier-vscode",

				// theming
				"sainnhe.sonokai",
				// "reageyao.biosyntax"
			]
		},
		"codespaces": {
			"openFiles": [
				"README.md"
			]
		}
	}
}
